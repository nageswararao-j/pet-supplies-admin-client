"use strict";var app=angular.module("petAdminApp",["ngResource","ngRoute","ui.bootstrap","ui.router"]);app.config(["$routeProvider","$stateProvider","USER_ROLES",function(e,t,r){e.when("/login",{templateUrl:"views/login.html",controller:"LoginController",controllerAs:"login"}).when("/signUp",{templateUrl:"views/signUp.html",controller:"SignUpController",controllerAs:"signUp"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/productMgtLanding",{templateUrl:"views/product-management.html",controller:"ProductMgtController",controllerAs:"productMgtController"}).when("/orderManagement",{templateUrl:"views/order-management.html",controller:"OrderMgtController",controllerAs:"orderMgtController"}).when("/categoryManagement",{templateUrl:"views/category-management.html",controller:"CategoryMgtController",controllerAs:"categoryMgtController"}).when("/pictureManagement",{templateUrl:"views/picture-management.html",controller:"PictureMgtController",controllerAs:"pictureMgtController"}).when("/userManagement",{templateUrl:"views/user-management.html",controller:"UserMgtController",controllerAs:"userMgtController"}).otherwise({redirectTo:"/login"}),t.state("index",{url:"/views",templateUrl:"views/index.html",data:{authorizedRoles:[r.admin,r.editor]}})}]),app.run(["$rootScope","ENVIRONMENT",function(e,t){e.baseUrl=t.baseUrl}]),app.factory("AuthService",["$http","$rootScope","Session","USER_ROLES","AUTH_EVENTS","ERROR",function(e,t,r,n,o,l){var a={};return a.login=function(a){return e.post(t.baseUrl+"/admin/login",a).success(function(e){return r.create(e.emailId,e.id,n.admin),e.data}).error(function(e){e.present&&(console.log("Error while registering into admin/seller app"),t.$broadcast(o.existingUser,{errorMsg:l.EMAIL_EXISTS}))})},a.isAuthenticated=function(){return!!r.id},a.currentUser=function(e){r.currentUser=e},a.isAuthorized=function(e){return a.isAuthenticated()},a}]),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",existingUser:"user-exists"}),app.constant("USER_ROLES",{admin:"ADMIN"}),app.constant("ENVIRONMENT",{mode:"dev",baseUrl:"http://localhost:8080"}),app.constant("ERROR",{EMAIL_EXISTS:"Email Id already exists! Please login"}),app.constant("ORDERS",{received:"Order received",readyToShip:"Ready to ship",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled"}),app.constant("MENUS",function(e){var t={};return t.CATEGORIES="categoryManagement",t.PRODUCTS="productMgtLanding",t.ORDERS="orderManagement",t.USERS="userManagement",t.PICTURES="pictureManagement",t[e]}),app.factory("OrderMgtService",["$http","$rootScope",function(e,t){var r=function(r){return e({url:t.baseUrl+"/order/load/"+r,dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded order successfully!")}).error(function(e){console.log("Error while loading orders !")})},n=function(r){return e({url:t.baseUrl+"/order/update/",dataType:"json",method:"POST",data:r,headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded order successfully!")}).error(function(e){console.log("Error while loading orders !")})};return{loadOrders:r,updateOrder:n}}]),app.factory("ProductMgtService",["$http","$rootScope",function(e,t){var r=function(r){return e.post(t.baseUrl+"/product/save/",r).success(function(e){console.log("Saved Cart Item successfully!")}).error(function(e){console.log("Error while saving Cart Item")})},n=function(r){return e({url:t.baseUrl+"/product/delete/",dataType:"json",method:"DELETE",data:r,headers:{"Content-Type":"application/json"}}).success(function(e){200==e.status&&console.log("Deleted Cart Item successfully!")}).error(function(e){console.log("Error while Deleting products !")})},o=function(r){return e({url:t.baseUrl+"/product/load/"+r,dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded products successfully!")}).error(function(e){console.log("Error while loading products !")})};return{saveProduct:r,loadAllProducts:o,deleteProduct:n}}]),app.service("Session",function(){this.currentUser={},this.cartItems={},this.isItemsPresent={},this.create=function(e,t,r){this.id=e,this.userId=t,this.userRole=r},this.destroy=function(){this.id=null,this.userId=null,this.userRole=null}}),app.controller("CategoryMgtController",["$scope","$location","Session","MENUS",function(e,t,r,n){e.currentUser=null,e.name=r.currentUser.name,e.load=function(e){t.path(n(e))}}]),app.controller("LoginController",["$scope","$location","$rootScope","AuthService","AUTH_EVENTS","USER_ROLES",function(e,t,r,n,o,l){var a={emailId:"",password:""};e.credentials=a,e.invalidCredentials="",e.currentUser=null,e.userRoles=l,e.isAuthorized=n.isAuthorized(l),e.loginApp=function(){n.login(e.credentials).then(function(l){r.$broadcast(o.loginSuccess),e.setCurrentUser(l.data),n.isAuthorized()?(n.currentUser(e.currentUser),t.path("/main")):(e.invalidCredentials="Invalid credentials! Please check username & paswword",e.credentials=a,t.path("/login"))},function(){r.$broadcast(o.loginFailed)})},e.setCurrentUser=function(t){e.currentUser=t},e.signUp=function(){t.path("/signUp")}}]),app.controller("MainCtrl",["$scope","USER_ROLES","AuthService","$location","Session","MENUS",function(e,t,r,n,o,l){e.currentUser=null,e.name=o.currentUser.name,e.load=function(e){n.path(l(e))},e.signOut=function(){o.currentUser=null,n.path("/login")}}]),app.controller("OrderMgtController",["$scope","$location","Session","OrderMgtService","MENUS",function(e,t,r,n,o){e.currentUser=null,e.name=r.currentUser.name,e.orderedProducts={},n.loadOrders(r.currentUser.id).then(function(t){e.orderedProducts=t.data}),e.load=function(e){t.path(o(e))},e.updateOrder=function(t){n.updateOrder(t).then(function(t){e.orderedProducts=t.data})}}]),app.controller("PictureMgtController",["$scope","$location","Session","MENUS",function(e,t,r,n){e.currentUser=null,e.name=r.currentUser.name,e.load=function(e){t.path(n(e))}}]),app.controller("PopupsController",["$scope","$modal",function(e,t){e.openCreateProduct=function(){t.open({templateUrl:"views/createProduct.html",controller:"ProductMgtController"})},e.openUpdateProduct=function(e){t.open({templateUrl:"views/updateProduct.html",controller:"ProductMgtController",resolve:{productToUpdated:function(){return e}}})}}]),app.controller("ProductMgtController",["$scope","$location","Session","MENUS","ProductMgtService",function(e,t,r,n,o){e.currentUser=null,e.name=r.currentUser.name,e.allProducts={},o.loadAllProducts(r.currentUser.id).then(function(t){e.allProducts=t.data}),e.load=function(e){t.path(n(e))},e.addProduct=function(){var e=l();o.saveProduct(e).then(function(e){console.log("Saved product successfully!")})};var l=function(){var t={};return t.productName=e.productName,t.desc=e.desc,t.price=e.price,t.status=e.statusVal,t.currency=e.currency,t.quantity=e.quantity,t.categoryCode=e.category,t.imageUrls=[{name:e.imageName,url:e.imageUrl}],t.sellerId=r.currentUser.id,t};e.deleteProduct=function(e){o.deleteProduct(e).then(function(){console.log("Deleted product successfully!")})}}]),app.controller("SignUpController",["$scope","$location","Session","AuthService","USER_ROLES","AUTH_EVENTS",function(e,t,r,n,o,l){e.signUpToApp=function(){e.user=a(),n.login(e.user).then(function(r){var o=r.data;o.present?(e.userPresent="Email Id already registered,Please login",t.path("/signUp")):void 0!=o&&o.active&&(e.currentUser=o,n.currentUser(o),t.path("/main"))})};var a=function(){var t={};return t.name=e.name,t.password=e.password,t.emailId=e.email,t.address=c(),t.phone=e.phone,t.register=!0,t.profile=o.admin,t},c=function(){var t={};return t.address=e.doorNum,t.city=e.city,t.state=e.state,t.zipCode=e.zipCode,t.email=e.email,t.phone=e.phone,t.country=e.country,t};e.login=function(){t.path("/login")},e.$on(l.existingUser,function(t,r){e.emailExists=r.errorMsg})}]),app.controller("UserMgtController",["$scope","$location","Session","MENUS",function(e,t,r,n){e.currentUser=null,e.name=r.currentUser.name,e.load=function(e){t.path(n(e))}}]),app.directive("dynamicTemplate",function(){return{template:'<ng-include src="getTemplateUrl()"/>',scope:{catagory:"=catagory"},restrict:"E",controller:["$scope",function(e){e.getTemplateUrl=function(){if(void 0!=e.catagory)return"views/"+e.catagory+".html"}}]}}),app.filter("millSecondsToDateString",function(){return function(e){var t=new Date(e);return t.toLocaleDateString()}}),app.directive("validateEmail",function(){var e=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return{require:"ngModel",restrict:"",link:function(t,r,n,o){o&&o.$validators.email&&(o.$validators.email=function(t){return o.$isEmpty(t)||e.test(t)})}}});