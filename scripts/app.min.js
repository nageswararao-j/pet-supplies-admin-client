"use strict";var app=angular.module("petAdminApp",["ngResource","ngRoute","ui.bootstrap","ui.router"]);app.config(["$routeProvider","$stateProvider","USER_ROLES",function(e,t,o){e.when("/login",{templateUrl:"views/login.html",controller:"LoginController",controllerAs:"login"}).when("/signUp",{templateUrl:"views/signUp.html",controller:"SignUpController",controllerAs:"signUp"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/productMgtLanding",{templateUrl:"views/product-management.html",controller:"ProductMgtController",controllerAs:"productMgtController"}).when("/orderManagement",{templateUrl:"views/order-management.html",controller:"OrderMgtController",controllerAs:"orderMgtController"}).when("/categoryManagement",{templateUrl:"views/category-management.html",controller:"CategoryMgtController",controllerAs:"categoryMgtController"}).when("/pictureManagement",{templateUrl:"views/picture-management.html",controller:"PictureMgtController",controllerAs:"pictureMgtController"}).when("/userManagement",{templateUrl:"views/user-management.html",controller:"UserMgtController",controllerAs:"userMgtController"}).otherwise({redirectTo:"/login"}),t.state("index",{url:"/views",templateUrl:"views/index.html",data:{authorizedRoles:[o.admin,o.editor]}})}]),app.run(["$rootScope","ENVIRONMENT",function(e,t){e.baseUrl=t.baseUrl}]),app.factory("AuthService",["$http","$rootScope","Session","USER_ROLES","AUTH_EVENTS","ERROR",function(e,t,o,r,n,l){var a={};return a.login=function(a){return e.post(t.baseUrl+"/admin/login",a).success(function(e){return o.create(e.emailId,e.id,r.admin),e.data}).error(function(e){e.present&&(console.log("Error while registering into admin/seller app"),t.$broadcast(n.existingUser,{errorMsg:l.EMAIL_EXISTS}))})},a.isAuthenticated=function(){return!!o.id},a.currentUser=function(e){o.currentUser=e},a.isAuthorized=function(e){return a.isAuthenticated()},a}]),app.factory("CategoryMgtService",["$http","$rootScope",function(e,t){var o=function(o){return e.post(t.baseUrl+"/category/save/",o).success(function(e){console.log("Saved Cart Item successfully!")}).error(function(e){console.log("Error while saving Cart Item")})},r=function(o){return e({url:t.baseUrl+"/category/delete/",dataType:"json",method:"DELETE",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){200==e.status&&console.log("Deleted category successfully!")}).error(function(e){console.log("Error while Deleting category !")})},n=function(o){return e({url:t.baseUrl+"/category/load/"+o,dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded categories successfully!")}).error(function(e){console.log("Error while loading categories !")})};return{saveCategory:o,loadAllCategories:n,deleteCategory:r}}]),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",existingUser:"user-exists"}),app.constant("USER_ROLES",{admin:"ADMIN"}),app.constant("ENVIRONMENT",{mode:"dev",baseUrl:"http://localhost:8080"}),app.constant("ERROR",{EMAIL_EXISTS:"Email Id already exists! Please login"}),app.constant("ORDERS",{received:"Order received",readyToShip:"Ready to ship",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled"}),app.constant("MENUS",function(e){var t={};return t.CATEGORIES="categoryManagement",t.PRODUCTS="productMgtLanding",t.ORDERS="orderManagement",t.USERS="userManagement",t.PICTURES="pictureManagement",t[e]}),app.factory("ImageMgtService",["$http","$rootScope",function(e,t){var o=function(o){return e({url:t.baseUrl+"/image/delete/",dataType:"json",method:"DELETE",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){200==e.status&&console.log("Deleted image successfully!")}).error(function(e){console.log("Error while Deleting image !")})},r=function(o){return e({url:t.baseUrl+"/image/update/",dataType:"json",method:"POST",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded image successfully!")}).error(function(e){console.log("Error while loading image !")})},n=function(){return e({url:t.baseUrl+"/image/load/",dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded images successfully!")}).error(function(e){console.log("Error while loading images !")})};return{loadAllImages:n,deleteImage:o,updateImage:r}}]),app.factory("OrderMgtService",["$http","$rootScope",function(e,t){var o=function(o){return e({url:t.baseUrl+"/order/load/"+o,dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded order successfully!")}).error(function(e){console.log("Error while loading orders !")})},r=function(o){return e({url:t.baseUrl+"/order/update/",dataType:"json",method:"POST",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded order successfully!")}).error(function(e){console.log("Error while loading orders !")})};return{loadOrders:o,updateOrder:r}}]),app.factory("ProductMgtService",["$http","$rootScope",function(e,t){var o=function(o){return e.post(t.baseUrl+"/product/save/",o).success(function(e){console.log("Saved product successfully!")}).error(function(e){console.log("Error while saving product")})},r=function(o){return e({url:t.baseUrl+"/user/update/",dataType:"json",method:"POST",data:order,headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded user successfully!")}).error(function(e){console.log("Error while loading user !")})},n=function(o){return e({url:t.baseUrl+"/product/delete/",dataType:"json",method:"DELETE",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){200==e.status&&console.log("Deleted product successfully!")}).error(function(e){console.log("Error while Deleting products !")})},l=function(o){return e({url:t.baseUrl+"/product/load/"+o,dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded products successfully!")}).error(function(e){console.log("Error while loading products !")})};return{saveProduct:o,loadAllProducts:l,deleteProduct:n,updateUser:r}}]),app.service("Session",function(){this.currentUser={},this.cartItems={},this.isItemsPresent={},this.create=function(e,t,o){this.id=e,this.userId=t,this.userRole=o},this.destroy=function(){this.id=null,this.userId=null,this.userRole=null}}),app.factory("UserMgtService",["$http","$rootScope",function(e,t){var o=function(o){return e({url:t.baseUrl+"/user/delete/",dataType:"json",method:"DELETE",data:category,headers:{"Content-Type":"application/json"}}).success(function(e){200==e.status&&console.log("Deleted user successfully!")}).error(function(e){console.log("Error while Deleting user !")})},r=function(o){return e({url:t.baseUrl+"/user/update/",dataType:"json",method:"POST",data:o,headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded user successfully!")}).error(function(e){console.log("Error while loading user !")})},n=function(){return e({url:t.baseUrl+"/user/load/",dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}}).success(function(e){console.log("Loaded users successfully!")}).error(function(e){console.log("Error while loading users !")})};return{loadAllUsers:n,deleteUser:o,updateUser:r}}]),app.controller("CategoryMgtController",["$scope","$location","Session","MENUS","CategoryMgtService",function(e,t,o,r,n){e.currentUser=null,e.name=o.currentUser.name,e.load=function(e){t.path(r(e))},e.allCategories={},n.loadAllCategories(o.currentUser.id).then(function(t){e.allCategories=t.data}),e.addCategory=function(){var e=l();n.saveCategory(e).then(function(e){console.log("Saved category successfully!")})};var l=function(){var t={};return t.name=e.categoryName,t.code=e.categoryCode,t.sellerId=o.currentUser.id,t};e.deleteCategory=function(e){n.deleteCategory(e).then(function(){console.log("Deleted category successfully!")})},e.updateCategory=function(e){UserMgtService.updateCategory(user).then(function(){console.log("Updated Category successfully!")})}}]),app.controller("LoginController",["$scope","$location","$rootScope","AuthService","AUTH_EVENTS","USER_ROLES",function(e,t,o,r,n,l){var a={emailId:"",password:""};e.credentials=a,e.invalidCredentials="",e.currentUser=null,e.userRoles=l,e.isAuthorized=r.isAuthorized(l),e.loginApp=function(){r.login(e.credentials).then(function(l){o.$broadcast(n.loginSuccess),e.setCurrentUser(l.data),r.isAuthorized()?(r.currentUser(e.currentUser),t.path("/main")):(e.invalidCredentials="Invalid credentials! Please check username & paswword",e.credentials=a,t.path("/login"))},function(){o.$broadcast(n.loginFailed)})},e.setCurrentUser=function(t){e.currentUser=t},e.signUp=function(){t.path("/signUp")}}]),app.controller("MainCtrl",["$scope","USER_ROLES","AuthService","$location","Session","MENUS",function(e,t,o,r,n,l){e.currentUser=null,e.name=n.currentUser.name,e.load=function(e){r.path(l(e))},e.signOut=function(){n.currentUser=null,r.path("/login")}}]),app.controller("OrderMgtController",["$scope","$location","Session","OrderMgtService","MENUS",function(e,t,o,r,n){e.currentUser=null,e.name=o.currentUser.name,e.orderedProducts={},r.loadOrders(o.currentUser.id).then(function(t){e.orderedProducts=t.data}),e.load=function(e){t.path(n(e))},e.updateOrder=function(t){r.updateOrder(t).then(function(t){e.orderedProducts=t.data})}}]),app.controller("PictureMgtController",["$scope","$location","Session","MENUS","ImageMgtService",function(e,t,o,r,n){e.currentUser=null,e.name=o.currentUser.name,e.load=function(e){t.path(r(e))},e.allImages={},n.loadAllImages().then(function(t){e.allImages=t.data}),e.deleteImage=function(e){n.deleteImage(e).then(function(){console.log("Deleted image successfully!")})},e.updateImage=function(e){n.updateImage(e).then(function(){console.log("Updated image successfully!")})}}]),app.controller("PopupsController",["$scope","$modal",function(e,t){e.openCreateProduct=function(){t.open({templateUrl:"views/createProduct.html",controller:"ProductMgtController"})},e.openUpdateProduct=function(e){t.open({templateUrl:"views/updateProduct.html",controller:"ProductMgtController",resolve:{productToUpdated:function(){return e}}})},e.openCreateCategory=function(){t.open({templateUrl:"views/createCategory.html",controller:"CategoryMgtController"})},e.openUpdateCategory=function(e){t.open({templateUrl:"views/updateCategory.html",controller:"CategoryMgtController",resolve:{categoryToUpdated:function(){return category}}})},e.openUpdateUser=function(e){t.open({templateUrl:"views/updateUser.html",controller:"UserMgtController",resolve:{userToUpdated:function(){return e}}})},e.openUpdateImage=function(e){t.open({templateUrl:"views/updateImage.html",controller:"PictureMgtController",resolve:{imageToUpdated:function(){return e}}})}}]),app.controller("ProductMgtController",["$scope","$location","Session","MENUS","ProductMgtService",function(e,t,o,r,n){e.currentUser=null,e.name=o.currentUser.name,e.allProducts={},n.loadAllProducts(o.currentUser.id).then(function(t){e.allProducts=t.data}),e.load=function(e){t.path(r(e))},e.addProduct=function(){var e=l();n.saveProduct(e).then(function(e){console.log("Saved product successfully!")})};var l=function(){var t={};return t.productName=e.productName,t.desc=e.desc,t.price=e.price,t.status=e.statusVal,t.currency=e.currency,t.quantity=e.quantity,t.categoryCode=e.category,t.imageUrls=[{name:e.imageName,url:e.imageUrl}],t.sellerId=o.currentUser.id,t};e.deleteProduct=function(e){n.deleteProduct(e).then(function(){console.log("Deleted product successfully!")})},e.updateProduct=function(e){n.updateProduct(e).then(function(){console.log("Updated product successfully!")})}}]),app.controller("SignUpController",["$scope","$location","Session","AuthService","USER_ROLES","AUTH_EVENTS",function(e,t,o,r,n,l){e.signUpToApp=function(){e.user=a(),r.login(e.user).then(function(o){var n=o.data;n.present?(e.userPresent="Email Id already registered,Please login",t.path("/signUp")):void 0!=n&&n.active&&(e.currentUser=n,r.currentUser(n),t.path("/main"))})};var a=function(){var t={};return t.name=e.name,t.password=e.password,t.emailId=e.email,t.address=s(),t.phone=e.phone,t.register=!0,t.profile=n.admin,t},s=function(){var t={};return t.address=e.doorNum,t.city=e.city,t.state=e.state,t.zipCode=e.zipCode,t.email=e.email,t.phone=e.phone,t.country=e.country,t};e.login=function(){t.path("/login")},e.$on(l.existingUser,function(t,o){e.emailExists=o.errorMsg})}]),app.controller("UserMgtController",["$scope","$location","Session","MENUS","UserMgtService",function(e,t,o,r,n){e.currentUser=null,e.name=o.currentUser.name,e.load=function(e){t.path(r(e))},e.allUsers={},n.loadAllUsers().then(function(t){e.allUsers=t.data}),e.deleteUser=function(e){n.deleteCategory(e).then(function(){console.log("Deleted user successfully!")})},e.updateUser=function(e){n.updateUser(e).then(function(){console.log("Updated user successfully!")})}}]),app.directive("dynamicTemplate",function(){return{template:'<ng-include src="getTemplateUrl()"/>',scope:{catagory:"=catagory"},restrict:"E",controller:["$scope",function(e){e.getTemplateUrl=function(){if(void 0!=e.catagory)return"views/"+e.catagory+".html"}}]}}),app.filter("millSecondsToDateString",function(){return function(e){var t=new Date(e);return t.toLocaleDateString()}}),app.directive("validateEmail",function(){var e=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return{require:"ngModel",restrict:"",link:function(t,o,r,n){n&&n.$validators.email&&(n.$validators.email=function(t){return n.$isEmpty(t)||e.test(t)})}}});